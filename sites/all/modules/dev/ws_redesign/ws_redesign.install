<?php
/**
 * @file ws_redesign.install
 *
 * Some things can't be done with features, so we'll do them with hook_update_N() for deployment.
 *
 */

/**
 * Implements hook_install().
 *
 * Run updates that might need to be run.
 */
function ws_redesign_install() {
  ws_redesign_update_6002();
  ws_redesign_update_6003();
  ws_redesign_update_6004();
}


/**
 * Add required Warmshowers custom menus
 * - Footer menu
 * - Anon Main Menu
 * - Logged-in Main Menu
 */
//function ws_redesign_update_6001() {
//  $ret = array();
//
//  $ret[] = ws_redesign_create_custom_menu('footer_menu', t('Footer Menu'), t('Menu for use in Warmshowers Footer'));
//  $ret[] = ws_redesign_create_custom_menu('anon_main_menu', t('Anon Main Menu'), t('Main Menu for Warmshowers Anon User (Home/Signup/FAQ/etc)'));
//  $ret[] = ws_redesign_create_custom_menu('logged_in_main_menu', t('Logged In Main Menu'), t('Main Menu for Warmshowers Logged-In User (Home/FAQ/Forums/etc)'));
//
//  return $ret;
//}

/**
 * Disable blocks already configured for garland or warmshowers_zen. We want context to have complete control.
 */
function ws_redesign_update_6002() {
  $ret[] = update_sql("UPDATE {blocks} SET status = 0 WHERE theme IN ('warmshowers_zen', 'garland')");
  return $ret;
}

/**
 * Remove i18n variables not appropriate to new code/settings.php
 */
function ws_redesign_update_6003() {
  if (function_exists('i18n_variable') && $variables = i18n_variable()) {
    db_query("DELETE FROM {i18n_variable} WHERE name NOT IN (". db_placeholders($variables, 'varchar') . ')', $variables);
  }
}

/**
 * Revert features
 */
function ws_redesign_update_6004() {
  $reversions = array(
    'redesign_theme_and_block' => array('variable', 'context', 'fe_block_settings', 'views'),
    'redesign_views' => array('views'),
    'redesign_system_level' => array('variable'),
  );
  if (module_exists('redesign_development')) {
    $reversions['redesign_development'] = array('variable');
  }
  features_revert($reversions);
}
