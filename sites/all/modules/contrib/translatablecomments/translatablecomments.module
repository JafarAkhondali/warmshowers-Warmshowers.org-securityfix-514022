<?php
// $Id $

/**
 * @file
 * Make it possible to machine-translate any element of a page.
 *
 * Adapted from translatablecomments module by Dave Trainer.
 */

/**
 * Implementation of hook_init().
 *
 * Add css and javascript for this project.
 */
function translatablecomments_init() {
  drupal_add_css(drupal_get_path('module', 'translatablecomments') .'/translatablecomments.css');
  translatablecomments_install_js();
}

/**
 * Implementation of hook_menu.
 */
function translatablecomments_menu() {
  $items['admin/settings/translatablecomments'] = array(
    'title' => "Translatable Comments",
    'access arguments' => array('administer site configuration'),
    'page callback' => 'drupal_get_form',
    'page arguments' => array('translatablecomments_admin'),
  );
  return $items;
}

/**
 * Admin configuration form for translatablecomments.
 */
function translatablecomments_admin(&$form_state) {
  $form['translatablecomments_translate_classes'] = array(
    '#type' => 'textfield',
    '#title' => t('CSS Selector for regions to be translated'),
    '#description' => t('Enter a valid css selector for the items to be translated. For example, ".comment .content" would allow translation of comment bodies.'),
    '#default_value' => variable_get('translatablecomments_translate_classes', '.comment .content'),
  );
  $form['translatablecomments_auto_translate'] = array(
    '#type' => 'checkbox',
    '#title' => t("Automatically detect user language and translate."),
    '#description' => t("If this is checked, the user language will be determined from the \$language variable or from the browser language, and if it is different from the language in which the section is written, will be translated automatically."),
    '#default_value' => variable_get('translatablecomments_auto_translate', FALSE),
  );

  return system_settings_form($form);
}

/**
 * Install all the javascript we need to install.
 *
 * jquery translate does most of the work, but also load settings.
 */
function translatablecomments_install_js() {
  $path = drupal_get_path('module', 'translatablecomments');
  drupal_add_js("$path/translatablecomments.js");
  drupal_add_js("$path/js/jquery.translate.js");

  $settings = array(
    'translate_classes' => variable_get('translatablecomments_translate_classes', '.comment .content'),
    'auto_translate' => variable_get('translatablecomments_auto_translate', FALSE),
    'my_language_code' => substr($GLOBALS['language']->language, 0, 2),
    'my_language_name' => $GLOBALS['language']->name,

  );
  drupal_add_js(array('translatablecomments' => $settings), "setting");
}

